bin=build/bin
CC=clang
CCFLAGS=-target armv7-apple-darwin-macho -arch armv7 -framework IOKit -fuse-ld=gold -v
SDK=~/iPhoneOS7.0.sdk
INCLUDE=-I$(SDK)/System/Library/Frameworks/IOKit.framework.Versions/A/Headers
FRAMEWORKS=-F$(SDK)/System/Library/Frameworks/
DEVICE_IP=10.0.0.96

all: $(bin) $(bin)/poc

$(bin):
	mkdir -p $(bin)

$(bin)/poc: poc.c
	$(CC) $(CCFLAGS) $(INCLUDE) $(FRAMEWORKS) -isysroot $(SDK) poc.c -o $(bin)/poc.o

.PHONY: clean install run

clean:
	rm -rf build

install: $(bin)/poc
	scp $(bin)/poc root@$(DEVICE_IP):/usr/local/bin

run: install
	ssh root@$(DEVICE_IP) /usr/local/bin
